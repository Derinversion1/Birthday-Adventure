<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temi's Birthday Hike Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            background: linear-gradient(to bottom, #1a2a6c, #b21f1f, #1a2a6c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            border: 4px solid #fff;
            background: #000;
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.7);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #gameCanvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            text-align: left;
            z-index: 10;
            max-width: 350px;
        }
        
        #message {
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 18px;
            max-width: 500px;
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            line-height: 1.4;
            backdrop-filter: blur(5px);
        }
        
        #continueButton {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            display: block;
            margin: 0 auto;
        }
        
        #continueButton:hover {
            background: linear-gradient(45deg, #ff5252, #ff7979);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }
        
        #birthdayCard {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 5px solid #fff;
            max-width: 450px;
            animation: cardAppear 1.5s ease-out;
            z-index: 20;
            width: 80%;
        }
        
        @keyframes cardAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3) rotate(-10deg);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
        }
        
        #birthdayCard h1 {
            color: #fff;
            font-size: 32px;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        #birthdayCard p {
            color: #f8f9fa;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid #ff6b6b;
        }
        
        .title h1 {
            color: #ff6b6b;
            font-size: 36px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.7);
        }
        
        .title p {
            color: #fff;
            font-size: 18px;
            margin-top: 10px;
        }
        
        @media (max-width: 850px) {
            #gameContainer {
                width: 95vw;
                height: 70vh;
            }
            
            #gameCanvas {
                width: 100%;
                height: 100%;
            }
            
            #ui {
                max-width: 80%;
            }
            
            #message {
                font-size: 16px;
                padding: 15px;
            }
            
            #continueButton {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            #birthdayCard {
                padding: 30px;
            }
            
            #birthdayCard h1 {
                font-size: 28px;
            }
            
            #birthdayCard p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="title">
        <h1>🎂 Temi's Birthday Hike Adventure 🎂</h1>
        <p>A special journey created just for you!</p>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div id="message">Hello my love, What better way to celebrate your birthday than a little hike?</div>
            <button id="continueButton">Start Journey</button>
        </div>
        
        <div id="birthdayCard">
            <h1>🎉 Happy Birthday My Love! 🎉</h1>
            <p>I hope this new chapter in your life brings you lots of joy!</p>
            <p>Enjoy your day, you deserve every good thing life has to offer</p>
            <p>Like a hike, every step with you is an adventure.</p>
            <p>Here's to many more adventures! 💕</p>
            <p><strong>With all my love,</strong><br>Mr Thoughtful</p>
        </div>
    </div>

    <script>
        // Game state and configuration
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const message = document.getElementById('message');
        const button = document.getElementById('continueButton');
        const birthdayCard = document.getElementById('birthdayCard');
        
        // Game state variables
        let currentStep = 0;
        let targetCharacterX = 100;
        let currentCharacterX = 100;
        const characterSpeed = 2;
        let isMoving = false;
        let currentWalkAnimationFrame = 0;
        let currentWalkFrameIndex = 0;
        const walkFrameAnimationRate = 5;
        const PIXEL_SCALE = 4;
        
        // Sound effects - using embedded data URIs to avoid CORS issues
        const soundEffects = {
            forestAmbient: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
            leavesRustling: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
            cricketsChirping: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
            frogCroaking: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
            windGust: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
            waterLapping: "data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
        };
        
        // Audio context and buffers
        let audioContext;
        let soundBuffers = {};
        let ambientSource = null;
        let isAudioInitialized = false;
        
        // Game progression data
        const gameSteps = [
            {
                message: "🌲 You step deeper into the woods. The trees whisper happy birthday wishes as you pass by their ancient trunks.",
                environmentSound: 'leavesRustling',
                skyColor: { top: '#87CEEB', bottom: '#98FB98' },
                treeCount: 8,
                sunPosition: { x: 650, y: 80 },
                moonPosition: null,
                characterX: 100,
                showPartyAnimals: false,
                lakeVisible: false
            },
            {
                message: "🦗 It's getting late, the sun is setting. Can you hear the crickets starting their birthday serenade?",
                environmentSound: 'cricketsChirping',
                skyColor: { top: '#FFB347', bottom: '#FFA07A' },
                treeCount: 12,
                sunPosition: { x: 600, y: 100 },
                moonPosition: { x: 720, y: 60, opacity: 0.1 },
                characterX: 200,
                showPartyAnimals: false,
                lakeVisible: false
            },
            {
                message: "🐸 A family of friendly frogs greets you! They croak excitedly",
                environmentSound: 'frogCroaking',
                skyColor: { top: '#FF7F50', bottom: '#FF6347' },
                treeCount: 16,
                sunPosition: { x: 550, y: 140 },
                moonPosition: { x: 720, y: 70, opacity: 0.3 },
                characterX: 300,
                showPartyAnimals: false,
                lakeVisible: false
            },
            {
                message: "💨 Deeper in now, It's just you and the wind. It spurs you forward.",
                environmentSound: 'windGust',
                skyColor: { top: '#4169E1', bottom: '#6A5ACD' },
                treeCount: 20,
                sunPosition: { x: 500, y: 200 },
                moonPosition: { x: 700, y: 80, opacity: 0.7 },
                characterX: 400,
                showPartyAnimals: false,
                lakeVisible: false
            },
            {
                message: "🌙 The gurgling of the lake tells you you're in the right place. The enchanted moonlit lake sparkles before you like a field of diamonds. It looks like all the animals came to celebrate you!",
                environmentSound: 'waterLapping',
                skyColor: { top: '#191970', bottom: '#483D8B' },
                treeCount: 24,
                sunPosition: null,
                moonPosition: { x: 700, y: 80, opacity: 1.0 },
                lakeVisible: true,
                showPartyAnimals: true,
                characterX: 500
            }
        ];
        
        // Initialize audio system
        async function initAudio() {
            if (isAudioInitialized) return;
            
            try {
                // Create audio context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Load all sounds
                for (const [name, dataUri] of Object.entries(soundEffects)) {
                    try {
                        const response = await fetch(dataUri);
                        const arrayBuffer = await response.arrayBuffer();
                        soundBuffers[name] = await audioContext.decodeAudioData(arrayBuffer);
                    } catch (error) {
                        console.error(`Error loading sound ${name}:`, error);
                    }
                }
                
                // Start ambient forest sound
                playSound('forestAmbient', true);
                
                isAudioInitialized = true;
            } catch (error) {
                console.error("Audio initialization failed:", error);
            }
        }
        
        // Play a sound by name
        function playSound(name, loop = false) {
            if (!audioContext || !soundBuffers[name]) return null;
            
            const source = audioContext.createBufferSource();
            source.buffer = soundBuffers[name];
            source.connect(audioContext.destination);
            source.loop = loop;
            source.start(0);
            
            if (loop) {
                ambientSource = source;
            }
            
            return source;
        }
        
        // Character drawing with animation
        function drawCharacter(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            const bodyY = y + 8 * scale;
            
            // Walking animation offsets
            const walkCycleOffsets = [
                [0, 0, 0, 0],
                [scale, -scale, -scale, scale],
                [0, 0, 0, 0],
                [-scale, scale, scale, -scale]
            ];
            
            const currentOffsets = walkCycleOffsets[currentWalkFrameIndex];
            const [llY, rlY, laY, raY] = currentOffsets;
            
            // Brown skin
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + 2*scale, bodyY, 4*scale, 4*scale); // head
            
            // Eye
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 4.25*scale, bodyY + 1*scale, 1.5*scale, 1.5*scale);
            
            // Arms
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + 1*scale, bodyY + 6*scale + laY, 2*scale, 2*scale); // left arm
            ctx.fillRect(x + 5*scale, bodyY + 6*scale + raY, 2*scale, 2*scale); // right arm
            
            // Red beanie
            ctx.fillStyle = '#DC143C';
            ctx.fillRect(x + 1*scale, bodyY - 1*scale, 6*scale, 3*scale);
            ctx.fillRect(x + 2*scale, bodyY - 2*scale, 4*scale, 2*scale);
            
            // Red sweater
            ctx.fillStyle = '#DC143C';
            ctx.fillRect(x + 1*scale, bodyY + 4*scale, 6*scale, 4*scale);
            
            // Black pants
            ctx.fillStyle = '#000000';
            ctx.fillRect(x + 2*scale, bodyY + 8*scale + llY, 2*scale, 4*scale); // left leg
            ctx.fillRect(x + 4*scale, bodyY + 8*scale + rlY, 2*scale, 4*scale); // right leg
            
            // Party hat (only at the end)
            if (hasPartyHat) {
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 3*scale, bodyY - 4*scale, 2*scale, 4*scale);
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x + 2*scale, bodyY - 1*scale, 4*scale, 1*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 3*scale, bodyY - 5*scale, 2*scale, 1*scale);
            }
        }
        
        // Frog sprite with party hat
        function drawFrog(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            
            ctx.fillStyle = '#228B22';
            ctx.fillRect(x + 2*scale, y + 4*scale, 8*scale, 4*scale);
            ctx.fillRect(x, y + 6*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 10*scale, y + 6*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 1*scale, y + 8*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 9*scale, y + 8*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 3*scale, y + 2*scale, 6*scale, 3*scale);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 4*scale, y + 2*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 7*scale, y + 2*scale, 1*scale, 1*scale);
            
            if (hasPartyHat) {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x + 4*scale, y - 1*scale, 4*scale, 2*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 5*scale, y - 2*scale, 2*scale, 1*scale);
            }
        }
        
        // Cricket sprite with party hat
        function drawCricket(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            
            ctx.fillStyle = '#2F4F2F';
            ctx.fillRect(x + 2*scale, y + 3*scale, 4*scale, 2*scale);
            ctx.fillRect(x + 6*scale, y + 3*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 1*scale, y + 4*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 7*scale, y + 4*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 0*scale, y + 5*scale, 1*scale, 2*scale);
            ctx.fillRect(x + 8*scale, y + 5*scale, 1*scale, 2*scale);
            ctx.fillRect(x + 1*scale, y + 7*scale, 1*scale, 3*scale);
            ctx.fillRect(x + 7*scale, y + 7*scale, 1*scale, 3*scale);
            ctx.fillRect(x + 3*scale, y + 2*scale, 2*scale, 2*scale);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 3*scale, y + 1*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 4*scale, y + 1*scale, 1*scale, 1*scale);
            
            if (hasPartyHat) {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x + 2*scale, y, 3*scale, 1*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 3*scale, y - 1*scale, 1*scale, 1*scale);
            }
        }
        
        // Deer sprite with party hat
        function drawDeer(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + 4*scale, y + 6*scale, 6*scale, 8*scale);
            ctx.fillRect(x + 2*scale, y + 12*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 8*scale, y + 12*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 3*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 9*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 3*scale, y + 4*scale, 4*scale, 4*scale);
            ctx.fillRect(x + 2*scale, y + 2*scale, 3*scale, 4*scale);
            
            ctx.fillStyle = '#5D4037';
            ctx.fillRect(x, y, 2*scale, 2*scale);
            ctx.fillRect(x + 5*scale, y, 2*scale, 2*scale);
            ctx.fillRect(x - 1*scale, y + 1*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 6*scale, y + 1*scale, 1*scale, 1*scale);
            
            if (hasPartyHat) {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x + 1*scale, y - 2*scale, 5*scale, 2*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 3*scale, y - 3*scale, 1*scale, 1*scale);
            }
        }
        
        // Horse sprite with party hat
        function drawHorse(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(x + 4*scale, y + 6*scale, 8*scale, 6*scale);
            ctx.fillRect(x + 3*scale, y + 12*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 9*scale, y + 12*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 4*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 10*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 2*scale, y + 4*scale, 4*scale, 8*scale);
            ctx.fillRect(x, y + 6*scale, 2*scale, 4*scale);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 2*scale, y + 4*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 1*scale, y + 5*scale, 1*scale, 3*scale);
            
            if (hasPartyHat) {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x, y, 2*scale, 4*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x, y - 1*scale, 2*scale, 1*scale);
            }
        }
        
        // Bear sprite with party hat
        function drawBear(x, y, hasPartyHat = false) {
            const scale = PIXEL_SCALE;
            
            ctx.fillStyle = '#654321';
            ctx.fillRect(x + 3*scale, y + 6*scale, 8*scale, 8*scale);
            ctx.fillRect(x + 2*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 9*scale, y + 14*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 3*scale, y + 16*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 10*scale, y + 16*scale, 2*scale, 4*scale);
            ctx.fillRect(x + 4*scale, y + 2*scale, 6*scale, 4*scale);
            ctx.fillRect(x + 3*scale, y + 1*scale, 2*scale, 2*scale);
            ctx.fillRect(x + 9*scale, y + 1*scale, 2*scale, 2*scale);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(x + 5*scale, y + 4*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 8*scale, y + 4*scale, 1*scale, 1*scale);
            ctx.fillRect(x + 6*scale, y + 5*scale, 2*scale, 1*scale);
            
            if (hasPartyHat) {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(x + 6*scale, y, 2*scale, 2*scale);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x + 6*scale, y - 1*scale, 2*scale, 1*scale);
            }
        }
        
        // Environment rendering
        function drawEnvironment() {
            const step = gameSteps[Math.min(currentStep, gameSteps.length - 1)];
            
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, step.skyColor.top);
            gradient.addColorStop(1, step.skyColor.bottom);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ground
            if (step.lakeVisible) {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, canvas.height - 100, canvas.width * 2/3, 100);
                
                ctx.fillStyle = '#4682B4';
                ctx.fillRect(canvas.width * 2/3, canvas.height - 100, canvas.width * 1/3, 100);
            } else {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
            }
            
            // Trees
            ctx.fillStyle = '#654321';
            for (let i = 0; i < step.treeCount; i++) {
                const x = (i * 40 + 30 + Math.sin(i) * 20) % (canvas.width + 40) - 20;
                const height = 80 + Math.sin(i * 0.5) * 30;
                const width = 15 + Math.sin(i * 0.3) * 5;
                
                if (step.lakeVisible && x > canvas.width * 2/3 - 20) continue;
                
                ctx.fillRect(x, canvas.height - 100 - height, width, height);
                
                ctx.fillStyle = currentStep < 3 ? '#228B22' : '#1F4F1F';
                const foliageWidth = width * 3;
                const foliageHeight = 40 + Math.sin(i * 0.7) * 15;
                ctx.fillRect(x - foliageWidth/2 + width/2, canvas.height - 100 - height - foliageHeight, foliageWidth, foliageHeight);
                
                ctx.fillStyle = '#654321';
            }
            
            // Sun
            if (step.sunPosition) {
                const sunGradient = ctx.createRadialGradient(
                    step.sunPosition.x, step.sunPosition.y, 0,
                    step.sunPosition.x, step.sunPosition.y, 50
                );
                sunGradient.addColorStop(0, '#FFD700');
                sunGradient.addColorStop(0.3, '#FFA500');
                sunGradient.addColorStop(1, 'rgba(255,165,0,0)');
                
                ctx.fillStyle = sunGradient;
                ctx.beginPath();
                ctx.arc(step.sunPosition.x, step.sunPosition.y, 50, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Moon
            if (step.moonPosition) {
                const moonGradient = ctx.createRadialGradient(
                    step.moonPosition.x, step.moonPosition.y, 0, 
                    step.moonPosition.x, step.moonPosition.y, 45
                );
                moonGradient.addColorStop(0, `rgba(255,250,240,${step.moonPosition.opacity})`);
                moonGradient.addColorStop(0.7, `rgba(245,245,220,${step.moonPosition.opacity * 0.8})`);
                moonGradient.addColorStop(1, `rgba(245,245,220,${step.moonPosition.opacity * 0.3})`);
                
                ctx.fillStyle = moonGradient;
                ctx.beginPath();
                ctx.arc(step.moonPosition.x, step.moonPosition.y, 45, 0, 2 * Math.PI);
                ctx.fill();
                
                if (step.moonPosition.opacity > 0.5) {
                    ctx.fillStyle = `rgba(230,230,250,${step.moonPosition.opacity * 0.6})`;
                    ctx.beginPath();
                    ctx.arc(step.moonPosition.x - 10, step.moonPosition.y - 10, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(step.moonPosition.x + 10, step.moonPosition.y + 5, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(step.moonPosition.x + 5, step.moonPosition.y - 5, 4, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            
            // Lake with moon reflection
            if (step.lakeVisible && step.moonPosition && step.moonPosition.opacity > 0.8) {
                const reflectionX = canvas.width * 2/3 + 50;
                const reflectionY = canvas.height - 60;
                
                ctx.fillStyle = 'rgba(255,250,240,0.7)';
                ctx.fillRect(reflectionX, reflectionY, 40, 35);
                
                ctx.fillStyle = 'rgba(255,250,240,0.9)';
                ctx.fillRect(reflectionX + 5, reflectionY + 5, 30, 25);
                
                for (let i = 0; i < 8; i++) {
                    const shimmerOpacity = 0.3 + Math.sin(Date.now() * 0.01 + i) * 0.2;
                    ctx.fillStyle = `rgba(255,250,240,${shimmerOpacity})`;
                    const shimmerX = reflectionX + i * 5;
                    const shimmerY = reflectionY + Math.sin(Date.now() * 0.008 + i) * 4;
                    ctx.fillRect(shimmerX, shimmerY, 5, 3);
                }
                
                for (let i = 0; i < 3; i++) {
                    const rippleOpacity = 0.1 + Math.sin(Date.now() * 0.005 + i * 2) * 0.05;
                    ctx.fillStyle = `rgba(255,250,240,${rippleOpacity})`;
                    const rippleY = reflectionY + 40 + i * 8;
                    ctx.fillRect(reflectionX - 10, rippleY, 60, 2);
                }
            }
        }
        
        // Main render function
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawEnvironment();
            
            const step = gameSteps[Math.min(currentStep, gameSteps.length - 1)];
            drawCharacter(currentCharacterX, canvas.height - 150, step.showPartyAnimals);
            
            if (step.showPartyAnimals) {
                drawFrog(50, canvas.height - 90, true);
                drawCricket(150, canvas.height - 85, true);
                drawDeer(250, canvas.height - 100, true);
                drawHorse(350, canvas.height - 110, true);
                drawBear(450, canvas.height - 110, true);
            }
        }
        
        // Character movement
        function moveCharacter() {
            if (Math.abs(currentCharacterX - targetCharacterX) > characterSpeed) {
                if (currentCharacterX < targetCharacterX) {
                    currentCharacterX += characterSpeed;
                } else {
                    currentCharacterX -= characterSpeed;
                }
                isMoving = true;
                
                currentWalkAnimationFrame++;
                if (currentWalkAnimationFrame % walkFrameAnimationRate === 0) {
                    currentWalkFrameIndex = (currentWalkFrameIndex + 1) % 4;
                }
                
                requestAnimationFrame(moveCharacter);
            } else {
                isMoving = false;
                currentWalkAnimationFrame = 0;
                currentWalkFrameIndex = 0;
            }
        }
        
        // Progress to next step
        function nextStep() {
            if (!isAudioInitialized) {
                initAudio();
            }
            
            if (currentStep < gameSteps.length) {
                const step = gameSteps[currentStep];
                message.textContent = step.message;
                
                // Play environment sound
                playSound(step.environmentSound);
                
                if (currentStep === gameSteps.length - 1) {
                    button.textContent = "🎁 Discover the Surprise";
                } else {
                    button.textContent = "Continue Journey →";
                }
                
                targetCharacterX = step.characterX;
                
                if (!isMoving) {
                    moveCharacter();
                }
                
                currentStep++;
            } else {
                if (ambientSource) {
                    ambientSource.stop();
                }
                document.getElementById('ui').style.display = 'none';
                birthdayCard.style.display = 'block';
            }
        }
        
        // Event listeners
        button.addEventListener('click', nextStep);
        
        // Animation loop
        function animate() {
            render();
            requestAnimationFrame(animate);
        }
        
        // Start the game
        render();
        animate();
    </script>
</body>
</html>
